server {
    listen 3000;
    server_name localhost;
    root /app/dist;
    index index.html;

    # Ensure the correct favicon is used; redirect legacy /favicon.ico to SVG
    location = /favicon.ico {
        return 301 /favicon.svg;
    }

    location = /favicon.svg {
        root /app/dist;
        try_files /favicon.svg =404;
        expires 1h;
        add_header Cache-Control "public, max-age=3600";
    }

    # Serve robots.txt from the built dist with a short cache
    location = /robots.txt {
        root /app/dist;
        try_files /robots.txt =404;
        expires 1h;
        add_header Cache-Control "public, max-age=3600";
    }
    # Support old/incorrect public paths by redirecting to root favicon
    location = /public/favicon.svg { return 301 /favicon.svg; }
    location = /public/favicon.ico { return 301 /favicon.svg; }

    # Handle static assets from Vite build
    location /assets/ {
        alias /app/dist/assets/;
        try_files $uri =404;
        expires 1y;
        add_header Cache-Control "public, no-transform";
    }

    # Handle public assets (SVG, PNG, etc.)
    location ~* \.(svg|png|jpg|jpeg|gif|ico|webp)$ {
        root /app/dist;
        try_files $uri =404;
        expires 1y;
        add_header Cache-Control "public, no-transform";
    }

    # Handle all other routes - SPA routing
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Enable gzip compression
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    # Cache static assets
    location ~* \.(css|js)$ {
        expires 1y;
        add_header Cache-Control "public, no-transform";
    }
} 